<domain type='kvm'>
  <name>{{ inventory_hostname }}</name>
  <memory unit='KiB'>{{ (memoryM * 1024) | int }}</memory>
  <currentMemory unit='KiB'>{{ (memoryM * 1024) | int }}</currentMemory>
  <os>
    <type>hvm</type>
  </os>
 <features>
    <acpi/>
    <apic/>
  </features>
  <devices>
    <emulator>/usr/libexec/qemu-kvm</emulator>

    <disk type='network' device='disk'>
      <driver name='qemu' type='qcow2'/>
      <source protocol='gluster' name='{{ gluster_libvirt_volume }}/{{ inventory_hostname }}.qcow2'>
        <host name='localhost'/>
      </source>
      <target dev='vda' bus='virtio'/>
      <boot order="2"/>
    </disk>

    <disk type='network' device='cdrom'>
      <driver name='qemu' type='raw'/>
      <source protocol='gluster' name='{{ gluster_libvirt_volume }}/{{ inventory_hostname }}.ks.iso'>
        <host name='localhost'/>
      </source>
      <target dev='hda' bus='ide'/>
      <readonly/>
    </disk>

    <disk type='network' device='cdrom'>
      <driver name='qemu' type='raw'/>
      <source protocol='gluster' name='{{ gluster_libvirt_volume }}/{{ iso.split("/")[-1] }}'>
        <host name='localhost'/>
      </source>
      <target dev='hdb' bus='ide'/>
      <boot order="1"/>
    </disk>

    <controller type='pci' index='0' model='pci-root'/>

{% for interface in interfaces %}
    <interface type='direct'>
      <source dev='{{ interface.macbridge }}' mode='bridge'/>
      <model type='virtio'/>
    </interface>
{% endfor %}

    <graphics type='spice' port='5900' autoport='yes' listen='127.0.0.1'>
      <listen type='address' address='127.0.0.1'/>
    </graphics>

    <video>
      <model type='cirrus' vram='16384' heads='1'/>
      <alias name='video0'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>
    </video>

    <rng model='virtio'>
      <backend model='random'>/dev/random</backend>
    </rng>
  </devices>
</domain>
